<!DOCTYPE html>
<!-- saved from url=(0076)http://demos.creative-tim.com/material-dashboard-pro/examples/dashboard.html -->
<html lang="en" class="perfect-scrollbar-on">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- <link rel="apple-touch-icon" sizes="76x76" href="http://demos.creative-tim.com/material-dashboard-pro/assets/img/apple-icon.png"> -->
    <!-- <link rel="icon" type="image/png" href="http://demos.creative-tim.com/material-dashboard-pro/assets/img/favicon.png"> -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>UFA CREDIT </title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta name="viewport" content="width=device-width">
    <!-- Canonical SEO -->
    <!-- Bootstrap core CSS     -->
    <link href="../../js/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/extra.css" rel="stylesheet">
    <!--  Material Dashboard CSS    -->
    <link href="../../css/material-dashboard.css?v=<?=time()?>" rel="stylesheet">
    <!-- <link href="../../css/AweetAlert.css?v=<?=time()?>" rel="stylesheet"> -->
    <link href="../../css/sweetalert.css" rel="stylesheet" >
    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <!-- <link href="css/main2.css?v=<?=time()?>" rel="stylesheet"> -->
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons" rel="stylesheet">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    
</head>

<body ng-app="myApp" ng-controller="myCtrl">
    <div class="preloader">
            <div class="content">
                <div class="circle">
                    <div class="inner"></div>
                </div>
                <div class="circle">
                    <div class="inner"></div>
                </div>
                <div class="circle">
                    <div class="inner"></div>
                </div>
                <div class="circle">
                    <div class="inner"></div>
                </div>
                <div class="circle">
                    <div class="inner"></div>
                </div>
            </div>
        </div>
    <div class="wrapper">
        <div class="sidebar" data-active-color="green" data-background-color="black" data-image="">
            <!--
        Tip 1: You can change the color of active element of the sidebar using: data-active-color="purple | blue | green | orange | red | rose"
        Tip 2: you can also add an image using data-image tag
        Tip 3: you can change the color of the sidebar with data-background-color="white | black"
    -->
            <div class="logo">
                <a href="" class="simple-text">
                UFA CREDIT 
                </a>
            </div>
            <div class="logo logo-mini">
                <a href="" class="simple-text">
                    UFA
                </a>
            </div>
            <div class="sidebar-wrapper">
               <!--  <div class="user">
                    <div class="photo">
                        <img src="img/profile.png">
                    </div>
                    <div class="info">
                        <a >
                            USERS ADMIN
                           
                        </a>
                       
                    </div>
                </div> -->
                <ul class="nav">
                    <!-- <li><i class=""></i></li> -->
                    <li x-ng-repeat-start="x in Menu">
                    </li>
                    <li class="ng-class:{'active':y.title == 'ผู้ใช้งาน'}" x-ng-repeat-end ng-repeat="y in x.group">
                            <a ng-if="y.title == 'ผู้ใช้งาน' || y.title == 'สรุปภาพรวม' || y.title == 'สรุปยอดตามเวลา' || y.title == 'อนุมัต ฝาก-ถอน'"  href="{{y.url}}" id="menu_{{y.id}}">
                                <i class='{{ y.symbol }}' aria-hidden="true"></i>
                                <p ng-bind="y.title"></p> <span class="badge notification-left"></span>
                            </a>

                            <a data-toggle="collapse" href="#menu_{{y.id}}" ng-if="y.title =='จัดการเว็บเอเย่น' || y.title == 'จัดการธนาคาร' || y.title == 'จัดการสมาชิกเว็บ' || y.title == 'จัดการรายการ ฝาก-ถอน'" >
                                <i class='{{ y.symbol }}' aria-hidden="true"></i>
                                <p ><span ng-bind="y.title"></span><b class="caret"></b></p> 
                            </a>

                            

                                <div ng-if="y.title =='จัดการเว็บเอเย่น' || y.title == 'จัดการธนาคาร' || y.title == 'จัดการสมาชิกเว็บ' || y.title == 'จัดการรายการ ฝาก-ถอน'" class="collapse" id="menu_{{y.id}}">
                            <ul class="nav" > 
                                <li x-ng-repeat-end ng-repeat="z in x.data">
                                    <a href="{{z.url}}">
                                        <i class='{{ z.symbol }}'></i><span ng-bind="z.title"></span>
                                    </a>
                                </li>                                
                                
                            </ul>
                        </div>
                            
                    </li>            
                </ul>
       </div>
            <div class="sidebar-background"></div>
        </div>
        <div class="main-panel">
            <nav class="navbar navbar-transparent navbar-fixed">
                <div class="container-fluid">
                    <div class="navbar-minimize">
                        <button id="minimizeSidebar" class="btn btn-round btn-white btn-fill btn-just-icon">
                            <i class="material-icons visible-on-sidebar-regular">more_vert</i>
                            <i class="material-icons visible-on-sidebar-mini">view_list</i>
                        </button>
                    </div>
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href=""> จัดการ ผู้ใช้งาน </a>
                    </div>
                    <div class="collapse navbar-collapse">
                        <ul class="nav_right  navbar-nav navbar-right" style="">
                            <li class="dropdown ">
                                <a href="">
                                    <i class="fa fa-bell fa-2x"></i>
                                    <span class="notification">5</span>   
                                    <p class="hidden-lg hidden-md">
                                        Notifications
                                </p>
                                </a>
                            </li>
                            <li class="dropdown " onclick="logout()">
                                <a href="">
                                    <i class="fa fa-sign-out-alt fa-2x"></i>
                                    <p class="hidden-lg hidden-md">Logout</p>
                                </a>
                                
                            </li>
                            <li class="separator hidden-lg hidden-md"></li>
                        </ul>
                    </div>
                </div>
            </nav>
            
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <!-- <div class="col-md-12">
                             <div class="row">
                <div class="" style="background: #fff; padding-left: 10px;">
                    <div class="navigate" >
                        <a href="package.php">
                            <button type="button" class="btn btn-success btn-sm" style=""><i class="fa fa-sign-out fa-fw"></i> Back</button></a>
                        <ol class="breadcrumb" style="padding: 11px;padding-bottom: 0;background: #fff;
    display: inline-block; ">
                            <li><a href="package.php">Packages</a></li>
                            <li class="active">New Package</li>
                        </ol>
                    </div>
                </div>
                </div>
                        </div> -->
       				 <div  class="col-extra" style="margin-top:10px;">   
       				 <div class="note">
<a href="./new" class="btn green-meadow"><strong><i class="material-icons">add</i> เพิ่มข้อมูล</strong></a>
</div>             
        				<!-- <h3 class="page-title">จัดการ ผู้ใช้งาน</h3> -->
                        <div>
                           <div class="card-extra">
                           
   							 <div class="card-body">
   							 <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-picture"></i>กระดาน 
        </div>
    </div>
        <div class="table-responsive" style="padding: 7px 10px;">
            <table class="table table-bordered table-hover">
                <thead >
                    <tr>
		                <th width="14%"> ชื่อ </th>
		                <th width="14%"> เบอร์โทร </th>
		                <th width="14%"> Username </th>
		                <th width="14%"> ระดับ </th>
		                <th width="14%"> e-mail </th>
		                <th width="10%"> วันหมดอายุ </th>
		                <th width="28%">&nbsp;  </th>
		            </tr>
                </thead>
                <tbody id="tbody_data">
               <!--       
            	
               <tr>
                <td> เครื่อง 1  </td>
                <td>  </td>
                <td> cct01</td>
                <td> ufath.com    </td>
                <td> คอเซนเตอร์</td>
                <td> </td>
                <td>
                    <button class="btn btn-xs btn-info">แก้ไข</button>
                    <button class="btn btn-xs btn-danger">ลบ</button>
                                                        </td>
            </tr>-->
                        </tbody>
            </table>
        </div>
    </div>
							</div>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav class="pull-left">
                        <ul>
                            <li>
                                <a href="">
                                    Home
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    Company
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <p class="copyright pull-right">
                        ©
                        <!--  <script async="" src="/analytics.js.ดาวน์โหลด"></script> -->
                        <script>
                            document.write(new Date().getFullYear())
                        </script>2017
                        <a href=""></a>
                    </p>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- <div class="fixed-plugin">
    </div> -->
    <!--   Core JS Files   -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script src="../../js/jquery/jquery-ui.min.js" type="text/javascript"></script>
      <script src="../../js/bootstrap.min.js" type="text/javascript"></script>
      <script src="../../js/material.min.js" type="text/javascript"></script>
      <script src="../../js/jquery/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
      <script src="../../js/jquery.cookie.min.js"></script>
      <script defer src="../../js/all.js" ></script>
      <script src="../../js/jquery.validate.min.js"></script>
      <!--  Plugin for Date Time Picker and Full Calendar Plugin-->
      <script src="../../js/moment.min.js"></script>
      <!--  Charts Plugin -->
      <!-- <script src="js/chartist.min.js"></script> -->
      <!--  Plugin for the Wizard -->
      <script src="../../js/jquery.bootstrap-wizard.js"></script>
      <!--  Notifications Plugin    -->
      <!-- <script src="files/js-/bootstrap-notify.js"></script> -->
      <!--   Sharrre Library    -->
      <script src="../../js/jquery.sharrre.js"></script>
      <!-- DateTimePicker Plugin -->
      <script src="../../js/bootstrap-datetimepicker.js"></script>
      <!-- Vector Map plugin -->
      <script src="../../js/jquery-jvectormap.js"></script>
      <!-- Sliders Plugin -->
      <script src="../../js/nouislider.min.js"></script>
      <!--  Google Maps Plugin    -->
      <!-- <script src="files/js-/js"></script> -->
      <!-- Select Plugin -->
      <!-- <script src="../../js/query.select-bootstrap.js"></script> -->
      <!--  DataTables.net Plugin    -->
      <script src="../../js/jquery.datatables.js"></script>
      <script src="../../js/sweetalert3.js"></script>
      <!-- Sweet Alert 2 plugin -->
      <!-- <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> -->
      <!-- <script src="../../js/sweetalert2.js"></script> -->
      <!--    Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
      <script src="../../js/jasny-bootstrap.min.js"></script>
      <!--  Full Calendar Plugin    -->
      <script src="../../js/fullcalendar.min.js"></script>
      <!-- TagsInput Plugin -->
      <script src="../../js/jquery.tagsinput.js"></script>
      <!-- Material Dashboard javascript methods -->
      <script src="../../js/material-dashboard.js"></script>
      <!-- Material Dashboard DEMO methods, don't include it in your project! -->
      <script src="../../js/jquery/demo.js"></script>
      <script src="../../js/angular.min.js"></script>
      <script src="../../js/angular-cookies.min.js"></script>
      <script src="../../js/angular-route.js"></script>
       <script src="../../js/angular-base64.js"></script>      
        <script src="../../js/sweet-alert.min.js"></script>
       <script src="../../js/SweetAlert.js"></script>
       <script src="../../js/loading.js"></script>

       
    
      <!-- <script src="../../js/main.js?v=<?=time()?>"></script> -->
      <!-- <script type="text/javascript">
         $(document).ready(function() {
             // Javascript method's body can be found in assets/js/demos.js
             demo.initDashboardPageCharts();
             demo.initVectorMap();
         });
         </script> -->
      <div class="jvectormap-tip"></div>
   </body>
</html>
<script>
   var app = angular.module('myApp', ['ngCookies','base64']);
   app.controller('myCtrl', function($scope, $http, $cookies, $window,$base64,$location) {
        $scope.role;
        loadpage();
        $scope.token = $cookies.get('login');
        function loadpage() {
            if ($cookies.get('login')) {
                
                $http({
                    method: 'post',
                    url: "/getPageData",
                    data: $.param({
                        token: $cookies.get('login')
                    }),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(function(res) {
                    if (res == "invalid") {
                        location.href = "/login";
                        return;
                    }
//                    console.log(res)
                    $scope.isSuperAdmin = (res.data[0].role == 0) ? true : false;
                    $scope.isAdmin = (res.data[0].role == 1) ? true : false;
                    $scope.isUsernomal = (res.data[0].role == 10) ? true : false;
                    if (res.data[0].role == 0)
                        $scope.role = 0;
                    else if (res.data[0].role == 1)
                        $scope.role = 1;
                    else
                        $scope.role = 10;
                    if (res.data[0].email != undefined) {
                        $scope.name = (res.data[0].email).split('@');
                        $scope.Username = $scope.name[0];
                        console.log($scope.Username)
                    }
                    $scope.Menu = res.data[1];
//                    console.log($scope.Menu)
closeloading();
                });
            } 
			else {
                $window.location.href = '/login';
            }
            
            $http({
                    method: 'POST',
                    url: "/getalluser",
                    // data : $.param({token:$scope.token, id:$scope.id}),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then(function(res) {
                 	console.log(res);
                 	
                 	$.each(res.data, function( index, value ) {
					  console.log( value );
					  var btn_edit = "";
					  var btn_del = "";
					  var btn_recovery = "";
					  var btn_confirm = "";
					  var btn_del = "";
					  var selected_role_0 = "";
					  var selected_role_1 = "";
					  
					  if(value.expired_date.substring(0, 10)=="0000-00-00"){
						 	var exp_date = "-";
						 }else{
						 	var exp_date = value.expired_date.substring(0, 10);
						 }
					  
					  if(value.role==0){
						var lev = "ผู้จัดการ";
						var selected_role_0 = "selected";
					  }
					  else if(value.role==1){
					  	var lev = "คอเซนเตอร์";
					  	 btn_edit = '<button class="btn btn-xs btn-info btn_edit" onclick="editUser('+value.id+');" role="0" id="btn_edit_'+value.id+'" >แก้ไข</button>';
					  	 btn_del = '<button class="btn btn-xs btn-danger btn_delete" onclick="deleteUser('+value.id+');" id="btn_del_'+value.id+'" style="width:auto;"  >ปิดใช้าน</button>';
					  	 btn_recovery = '<button class="btn btn-xs btn-warning" onclick="recoveryUser('+value.id+');" style="display:none;" id="btn_re_'+value.id+'" >กู้คืน</button>';
					  	 btn_confirm = '<button class="btn btn-xs btn-success" onclick="confirmUser('+value.id+');" style="display:none;" id="btn_con_'+value.id+'" >บันทึก</button>';
					  	 var selected_role_1 = "selected";
					  }
var set_name = '<input class="form-control" type="text" name="data_machine_'+value.id+'" id="data_machine_'+value.id+'" value="'+value.machine+'" style="display:none;" /><span id="txt_machine_'+value.id+'">'+value.machine+'</span>';
var set_phone = '<input class="form-control" type="text" name="data_phone_'+value.id+'" id="data_phone_'+value.id+'" value="'+value.phone+'" style="display:none;" /><span id="txt_phone_'+value.id+'">'+value.phone+'</span>';
					  var set_username = '<input class="form-control" type="text" name="data_username_'+value.id+'" id="data_username_'+value.id+'" value="'+value.username+'" style="display:none;" /><span id="txt_username_'+value.id+'">'+value.username+'</span>';
					  var set_role = '<select class="form-control" name="data_role_'+value.id+'" id="data_role_'+value.id+'" style="display:none;" >'+
					  +'<option value="0" '+selected_role_0+'>ผู้จัดการ</option><option '+selected_role_0+' value="1">คอเซนเตอร์</option></select><span id="txt_role_'+value.id+'">'+lev+'</span>';
					  var set_mail = '<input class="form-control" type="text" name="data_email_'+value.id+'" id="data_email_'+value.id+'" value="'+value.email+'" style="display:none;" /><span id="txt_email_'+value.id+'">'+value.email+'</span>';
					 $('#tbody_data').append('<tr id="row_id_'+value.id+'" ><td> '+set_name+' </td><td>'+set_phone+'</td><td> '+set_username+' </td><td> '+set_role+'</td><td>'+set_mail+'</td><td> '+exp_date+'</td><td>'+btn_edit + btn_confirm + btn_del + btn_recovery +'</td></tr>');
					  
					});
                 	
                });
               
        }
    });
    
    				function editUser(id){
                		console.log('edit '+id);
                		
                		var check = $('#btn_edit_'+id).attr('role');
                		console.log(check);
                		if(check==0){
                			$('#row_id_'+id+' span').hide();
                			$('#row_id_'+id+' input ,#row_id_'+id+' select').show();
                			$('#btn_con_'+id).show();
                			$('#btn_edit_'+id).hide();
                			check = 1;
                		}
                		else{
                			$('#row_id_'+id+' span').show();
                			$('#row_id_'+id+' input ,#row_id_'+id+' select').hide();
                			check = 0;
                		}
                		$('#btn_edit_'+id).attr('role',check);						
//                		
                		
	                }
	                function deleteUser(id){
	                	console.log('del '+id);
	                	swal({
		                    title: 'ปิดการใช้งาน',
		                    text: "คุณแน่ใจหรือไม่ว่าต้องการปิดการใช้งาน ?",
		                    type: 'warning',
		                    showCancelButton: true,
		                    confirmButtonClass: 'btn btn-success',
		                    cancelButtonClass: 'btn btn-danger',
		                    confirmButtonText: 'ใช่',
		                    cancelButtonText: 'ไม่ใช่',
		                    buttonsStyling: false
		                }).then(function() {
		                	$.post('/deleteuser',function(respone){
		                		swal({
			                    title: 'Deleted!',
			                    text: 'Your file has been deleted.',
			                    type: 'success',
			                    confirmButtonClass: "btn btn-success",
			                    buttonsStyling: false
			                    });
	                		});
		                  
		                });
	                	
	                }
	                
	                function recoveryUser(id){
	                	console.log('re '+id);
	                } 
	                function confirmUser(id){
	                	console.log('re '+id);
	                	var username = $('#data_username_'+id).val();
	                	var email = $('#data_email_'+id).val();
	                	var role = $('#data_role_'+id).val();
	                	var machine = $('#data_machine_'+id).val();
	                	var phone = $('#data_phone_'+id).val();
//	                	var web_agent = $('#data_phone_'+id).val();
						
						var json = JSON.stringify({ username:username, role:role, phone:phone, machine:machine, email:email, id:id }, null, 4);
						console.log(json);
	                	$.post('/edituser',{ username:username, role:role, phone:phone, machine:machine, email:email, id:id },function(respone){
//	                		console.log(respone);
							$('#row_id_'+id+' span').show();
                			$('#row_id_'+id+' input ,#row_id_'+id+' select').hide();
                			
                			$('#txt_machine_'+id).text(machine);
                			$('#txt_phone_'+id).text(phone);
                			$('#txt_username_'+id).text(username);
                			$('#txt_role_'+id).text($('#data_role_'+id+' option:selected').text());
                			$('#txt_email_'+id).text(email);	
                			$('#btn_con_'+id).hide();
                			$('#btn_edit_'+id).show();	
                			$('#row_id_'+id).addClass('tr-save-success');
                			
                			setTimeout(function(){ $('#row_id_'+id).removeClass('tr-save-success'); }, 3000);
	                	});
	                } 
	               
</script>